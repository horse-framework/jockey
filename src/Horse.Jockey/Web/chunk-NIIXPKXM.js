import{$ as f,M as i,Z as u,a as l,g as c,s as S}from"./chunk-I3ZBIMQN.js";var n=class{static create(){var t=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var a=Math.random()*16;return t>0?(a=(t+a)%16|0,t=Math.floor(t/16)):(a=(e+a)%16|0,e=Math.floor(e/16)),(r==="x"?a:a&3|8).toString(16)})}};var s=class o{#a;#e="";supportedStorageEvents=["change","action","update","refresh"];useLocalStorageEvents=!0;#t=u(null);get state(){return this.#t.asReadonly()}#r=new c;get action$(){return this.#r}constructor(){this.#a=n.create(),this.useLocalStorageEvents&&(this.#e=this.constructor.name+"Event",addEventListener("storage",t=>{if(t.key!=this.#e)return;let e=t.newValue;if(e)try{let r=JSON.parse(e);if(!r.sender||r.sender==this.#a)return;switch(r.event){case"change":this.setState(r.payload,!1);break;case"update":this.updateState(r.payload,!1);break;case"refresh":this.refresh(!1);break;case"action":this.raiseAction(r.action,r.payload,!1);break}}catch{}}))}setStateSilent(t){this.#t.set(t)}setState(t,e=!0){let r={previous:this.#t(),state:t,name:"set",store:this};this.#t.set(t),this.#r.next(r),e&&this.sendLocalStorageEvent("change",t)}updateState(t,e=!0){if(this.#t()==null)return;let r=this.#t();this.#t.update(d=>l(l({},d),t));let a={name:"update",store:this,previous:r,state:this.#t(),payload:t};this.#r.next(a),e&&this.sendLocalStorageEvent("update",t)}refresh(t=!0){this.raiseAction("refresh",null,!1),t&&this.sendLocalStorageEvent("refresh",null)}raiseAction(t,e=null,r=!0){let a={previous:this.#t(),state:this.#t(),name:t,store:this,payload:e};this.#r.next(a),r&&this.sendLocalStorageEvent("action",e,t)}sendLocalStorageEvent(t,e,r=null){if(!this.useLocalStorageEvents||!this.supportedStorageEvents.includes(t))return;let a={sender:this.#a,event:t,payload:e,action:r};localStorage.setItem(this.#e,JSON.stringify(a)),setTimeout(()=>localStorage.removeItem(this.#e),1)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};var p=class o extends s{run(){let t=localStorage.getItem("token");t&&this.setStateSilent(JSON.parse(t)),S(5e3).subscribe(()=>{let e=this.state();e&&Math.floor(Date.now()/1e3)-e.expiration<0&&this.setState(null)})}static \u0275fac=(()=>{let t;return function(r){return(t||(t=f(o)))(r||o)}})();static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};export{p as a};
