import{M as a,O as l,Q as u,d as r,g as n}from"./chunk-I3ZBIMQN.js";var i=new l("ENVIRONMENT");function d(){return r(this,null,function*(){let s={production:!0,apiUrl:location.protocol.toLowerCase()+"//"+location.host+"/api",websocketUrl:location.protocol.toLowerCase().replace("http","ws")+"//"+location.host,version:"7.2.6"};return location.host=="localhost:4200"&&(s.apiUrl="http://localhost:2627/api",s.websocketUrl="ws://localhost:2627"),[{provide:i,useValue:s}]})}var h=class s{_status=0;_socket=null;_subscriptions=[];env=u(i);_onconnected=new n;_ondisconnected=new n;_onmessage=new n;get onconnected(){return this._onconnected}get ondisconnected(){return this._ondisconnected}get onmessage(){return this._onmessage}get status(){return this._status}constructor(){}isConnected(){return this._socket!=null&&this._socket.OPEN==1}connect(e){let t=this.env.websocketUrl+"?token="+e;this._socket=new WebSocket(t),this._socket.onopen=c=>{this._status=2,this._onconnected.next(this),this._subscriptions.forEach(o=>this.subscribe(o.channel))},this._socket.onclose=c=>{this._status=0,this._ondisconnected.next(this)},this._socket.onmessage=this.messageReceived.bind(this)}send(e,t){if(!this._socket||this._status!==2)return!1;let o=JSON.stringify({type:e,payload:t});return this._socket.send(o),!0}disconnect(){if(this._socket!=null){try{this._socket.close()}catch{}this._status=0,this._socket=null}}messageReceived(e){let t=JSON.parse(e.data);t==null||t.type==null||t.payload==null||this._onmessage.next(t)}subscribe(e){this._subscriptions.push({channel:e}),this.send("subscribe",{channel:e,join:!0})}unsubscribe(e){this._subscriptions=this._subscriptions.filter(t=>t.channel!=e),this.send("subscribe",{channel:e,join:!1})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})};export{i as a,d as b,h as c};
