"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[428],{428:(j,g,a)=>{a.r(g),a.d(g,{ChannelDetailModule:()=>Y});var h=a(6814),m=a(5861),x=a(9519),Z=a.n(x),_=a(3791),T=a(211),v=a(7734),y=a(6124),f=a(1418),M=a(8152),e=a(8124),d=a(9817),s=a(285);function b(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"input",8),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.model.value=n)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.model.value)}}function A(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"select",9),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.model.value=n)}),e.TgZ(1,"option",10),e._uU(2,"Yes"),e.qZA(),e.TgZ(3,"option",10),e._uU(4,"No"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.model.value),e.xp6(1),e.Q6J("ngValue",!0),e.xp6(2),e.Q6J("ngValue",!1)}}let O=(()=>{class i{get onconfirmed(){return this._onconfirmed}constructor(){this._onconfirmed=new M.xQ,this.model={confirmed:!1,title:"",property:"",value:null,type:"text"},this._confirmed=!1}ngOnInit(){}confirm(){this._confirmed=!0,this.model.confirmed=!0,this._onconfirmed.next(this.model)}ngOnDestroy(){this._confirmed||(this.model.confirmed=!1,this._onconfirmed.next(this.model))}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-channel-option-modal"]],decls:13,vars:3,consts:[["mat-dialog-title","",1,"title"],[1,"content"],[1,"form-item"],["placeholder","Option Value","class","target-text","type","text",3,"ngModel","ngModelChange",4,"ngIf"],["class","jockey-select",3,"ngModel","ngModelChange",4,"ngIf"],[1,"buttons"],["mat-button","","mat-dialog-close","",1,"modal-btn","btn-green",3,"click"],["mat-button","","mat-dialog-close","",1,"modal-btn","btn-grey"],["placeholder","Option Value","type","text",1,"target-text",3,"ngModel","ngModelChange"],[1,"jockey-select",3,"ngModel","ngModelChange"],[3,"ngValue"]],template:function(o,n){1&o&&(e.TgZ(0,"h2",0),e._uU(1,"Channel Option Change"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"label"),e._uU(5),e.qZA(),e.YNc(6,b,1,1,"input",3)(7,A,5,3,"select",4),e.qZA()(),e.TgZ(8,"mat-dialog-actions",5)(9,"button",6),e.NdJ("click",function(){return n.confirm()}),e._uU(10,"Confirm"),e.qZA(),e.TgZ(11,"button",7),e._uU(12,"Cancel"),e.qZA()()),2&o&&(e.xp6(5),e.Oqu(n.model.title),e.xp6(1),e.Q6J("ngIf","text"==n.model.type),e.xp6(1),e.Q6J("ngIf","checkbox"==n.model.type))},dependencies:[h.O5,d.ZT,d.uh,d.H8,d.xY,s.YN,s.Kr,s.Fj,s.EJ,s.JJ,s.On],styles:[".title[_ngcontent-%COMP%]{color:#eee}.content[_ngcontent-%COMP%]{padding:0 25px 10px;display:block}.content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#d2d2d2;font-size:14px;line-height:30px}.content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:20px 0}.target-text[_ngcontent-%COMP%]{border:1px solid #555;background-color:#000;color:#eee;font-size:14px;font-weight:500;padding:8px;width:320px}.target-text[_ngcontent-%COMP%]:focus, .target-text[_ngcontent-%COMP%]:active{border-color:#10a040}.form-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;align-content:stretch;align-items:stretch;justify-content:stretch;justify-items:stretch;padding:8px 0}.form-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:1 1 auto;color:#bbb;font-size:13px;text-transform:uppercase;padding:4px 0;font-weight:500}.form-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1 1 auto;width:432px}.form-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1 1 auto;width:450px}"]})}return i})();var U=a(3107),D=a(1842),p=a(6956),N=a(8287),I=a(8054),q=a(9826),k=a(9157);function J(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.viewInitialMessage())}),e._uU(1,"View"),e.qZA()}}function w(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"div",20),e._uU(5,"Name"),e.qZA(),e.TgZ(6,"div",21),e._uU(7),e.TgZ(8,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.remove())}),e._uU(9,"Delete"),e.qZA()()(),e.TgZ(10,"div",19)(11,"div",20),e._uU(12,"Topic"),e.qZA(),e.TgZ(13,"div",21),e._uU(14),e.TgZ(15,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeOption("Topic","topic",n.channel.topic))}),e._uU(16,"Change"),e.qZA()()(),e.TgZ(17,"div",19)(18,"div",20),e._uU(19,"Status"),e.qZA(),e.TgZ(20,"div",21),e._uU(21),e.qZA()(),e.TgZ(22,"div",19)(23,"div",20),e._uU(24,"Initial Message"),e.qZA(),e.TgZ(25,"div",21),e._uU(26),e.YNc(27,J,2,0,"a",23),e.qZA()(),e.TgZ(28,"div",19)(29,"div",20),e._uU(30,"Client Limit"),e.qZA(),e.TgZ(31,"div",21),e._uU(32),e.ALo(33,"unlimited"),e.TgZ(34,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeOption("Client Limit","clientLimit",n.channel.options.clientLimit))}),e._uU(35,"Change"),e.qZA()()(),e.TgZ(36,"div",19)(37,"div",20),e._uU(38,"Message Size Limit"),e.qZA(),e.TgZ(39,"div",21),e._uU(40),e.ALo(41,"unlimited"),e.TgZ(42,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeOption("Message Size Limit","messageSizeLimit",n.channel.options.messageSizeLimit))}),e._uU(43,"Change"),e.qZA()()(),e.TgZ(44,"div",19)(45,"div",20),e._uU(46,"Auto Destroy"),e.qZA(),e.TgZ(47,"div",21),e._uU(48),e.TgZ(49,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeOption("Auto Destroy","autoDestroy",n.channel.options.autoDestroy,"checkbox"))}),e._uU(50,"Change"),e.qZA()()(),e.TgZ(51,"div",19)(52,"div",20),e._uU(53,"Auto Destroy Idle"),e.qZA(),e.TgZ(54,"div",21),e._uU(55),e.TgZ(56,"a",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeOption("Auto Destroy Idle","autoDestroyIdleSeconds",n.channel.options.autoDestroyIdleSeconds))}),e._uU(57,"Change"),e.qZA()()()()()()}if(2&i){const t=e.oxw();e.xp6(7),e.hij(" ",t.channel.name," "),e.xp6(7),e.hij(" ",t.channel.topic," "),e.xp6(7),e.Oqu(t.channel.status),e.xp6(5),e.hij(" ",t.channel.hasInitialMessage?"":"None"," "),e.xp6(1),e.Q6J("ngIf",t.channel.hasInitialMessage),e.xp6(5),e.hij(" ",e.lcZ(33,9,t.channel.options.clientLimit)," "),e.xp6(8),e.hij(" ",e.lcZ(41,11,t.channel.options.messageSizeLimit)," "),e.xp6(8),e.hij(" ",t.channel.options.autoDestroy?"Yes":"No"," "),e.xp6(7),e.hij(" ",t.channel.options.autoDestroyIdleSeconds," Seconds ")}}function P(i,r){if(1&i&&(e.TgZ(0,"div",26)(1,"div",27)(2,"span"),e._uU(3),e.qZA()(),e.TgZ(4,"div",27)(5,"span"),e._uU(6),e.qZA()(),e.TgZ(7,"div",28)(8,"a",29),e._uU(9),e.qZA()(),e.TgZ(10,"div",30)(11,"span"),e._uU(12),e.ALo(13,"date"),e.qZA()()()),2&i){const t=r.$implicit;e.xp6(3),e.Oqu(t.type),e.xp6(3),e.Oqu(t.name),e.xp6(2),e.MGl("routerLink","/client/",t.id,""),e.xp6(1),e.Oqu(t.id),e.xp6(3),e.Oqu(e.xi3(13,5,1e3*t.subscriptionDate,"yyyy-MM-dd HH:mm:ss"))}}function S(i,r){if(1&i&&(e.TgZ(0,"div",24),e.YNc(1,P,14,8,"div",25),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.channel.subscribers)}}let H=(()=>{class i extends _.H{constructor(t,o,n,l,C,c){super(),this.activatedRoute=t,this.service=o,this.socket=n,this.dialog=l,this.router=C,this.chartService=c}ngOnInit(){var t=this;return(0,m.Z)(function*(){t.channelName=t.activatedRoute.snapshot.params.name,yield t.load(),t.subscribeWebsockets(),t.subscribeToListRefresh().subscribe(()=>t.service.get(t.channelName).then(o=>t.channel=o))})()}ngOnDestroy(){super.ngOnDestroy(),this.socket.unsubscribe("channel:"+this.channelName)}load(){var t=this;return(0,m.Z)(function*(){t.channel=yield t.service.get(t.channelName);let o=yield t.service.getGraph(t.channelName);t.channelChart&&t.channelChart.destroy(),t.channelChart=new(Z())(document.getElementById("messages-chart"),{type:"line",hover:{mode:"nearest",intersect:!0},data:{labels:o.labels,datasets:[{label:"Published",borderColor:"#2070e0",data:o.d.map(n=>n.s),fill:!1,pointRadius:1,pointHitRadius:8,lineTension:.2,borderWidth:2},{label:"Received",borderColor:"#10c070",data:o.d.map(n=>n.r),fill:!1,pointRadius:1,pointHitRadius:8,lineTension:.2,borderWidth:2}]},options:{animation:{duration:0},responsive:!0,scales:{xAxes:[{display:!1}],yAxes:[{display:!0,ticks:{precision:0}}]}}})})()}subscribeWebsockets(){this.on(this.socket.onmessage).pipe((0,v.h)(t=>t.type==T.S.ChannelGraph&&t.payload.n==this.channelName),(0,v.h)(()=>null!=this.channelChart),(0,y.U)(t=>t.payload)).subscribe(t=>this.chartService.updateChart(this.channelChart,t)),this.socket.subscribe("channel:"+this.channelName)}changeOption(t,o,n,l="text"){let c=this.dialog.open(O,{width:"500px"}).componentInstance;c.model.title=t,c.model.property=o,c.model.value=n,c.model.type=l,c.onconfirmed.pipe((0,f.q)(1)).subscribe(u=>{u.confirmed&&this.service.setOption(this.channelName,u.property,u.value).then(()=>this.load())})}remove(){let o=this.dialog.open(U.z,{width:"600px"}).componentInstance;o.message='You are about to delete <b class="imp">'+this.channelName+"</b> Channel. Are you sure?",o.onclosed.pipe((0,f.q)(1)).subscribe(n=>{n&&this.service.remove(this.channelName).then(l=>{this.router.navigateByUrl("/channels")})})}viewInitialMessage(){this.dialog.open(D.n,{width:"800px"}).componentInstance.load(this.channelName)}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(p.gz),e.Y36(N.T),e.Y36(I.i),e.Y36(d.uw),e.Y36(p.F0),e.Y36(q.C))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-channel-detail"]],features:[e.qOj],decls:30,vars:2,consts:[[1,"centered-body"],[1,"vertical-content"],[1,"dashboard-portlet"],[1,"portlet"],[1,"portlet-title"],[1,"portlet-canvas"],["id","messages-chart"],["class","portlet-body",4,"ngIf"],[1,"portlet","full"],[1,"portlet-body","table","table-small","nowrap"],[1,"thead"],[1,"th","fx24"],[1,"th","fx30"],[1,"th","fx22"],["class","tbody",4,"ngIf"],[2,"height","80px"],[1,"portlet-body"],[1,"portlet-table","grow","canvas-info"],[1,"key-value-table"],[1,"kvt-row"],[1,"kvt-key"],[1,"kvt-value"],[1,"change-option",3,"click"],["class","change-option",3,"click",4,"ngIf"],[1,"tbody"],["class","trow",4,"ngFor","ngForOf"],[1,"trow"],[1,"td","fx24"],[1,"td","fx30"],[3,"routerLink"],[1,"td","fx22"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),e._uU(5,"Channel Messages"),e.qZA(),e.TgZ(6,"div",5),e._UZ(7,"canvas",6),e.qZA()()(),e.TgZ(8,"div",2)(9,"div",3)(10,"h3",4),e._uU(11,"Options & Actions"),e.qZA(),e.YNc(12,w,58,13,"div",7),e.qZA()()()(),e.TgZ(13,"div",0)(14,"div",1)(15,"div",8)(16,"h3",4),e._uU(17,"Channel Subscribers"),e.qZA(),e.TgZ(18,"div",9)(19,"div",10)(20,"div",11),e._uU(21,"Type"),e.qZA(),e.TgZ(22,"div",11),e._uU(23,"Name"),e.qZA(),e.TgZ(24,"div",12),e._uU(25,"Id"),e.qZA(),e.TgZ(26,"div",13),e._uU(27,"Subscribed Date"),e.qZA()(),e.YNc(28,S,2,1,"div",14),e.qZA()()()(),e._UZ(29,"div",15)),2&o&&(e.xp6(12),e.Q6J("ngIf",n.channel),e.xp6(16),e.Q6J("ngIf",n.channel))},dependencies:[h.sg,h.O5,p.rH,h.uU,k.O]})}return i})();var L=a(658);let Y=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[h.ez,L.D,d.Is,s.u5,p.Bz.forChild([{path:":name",component:H}])]})}return i})()}}]);