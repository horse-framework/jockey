import{a as fe}from"./chunk-Q3OZ3U72.js";import{a as de,b as ue}from"./chunk-X7GHCXNM.js";import{a as he}from"./chunk-JSLFBEG5.js";import{c as K}from"./chunk-5TYYVYVB.js";import{a as pe}from"./chunk-VDQADRST.js";import{a as ve}from"./chunk-77IAIRUM.js";import{a as ge}from"./chunk-BQERTHYR.js";import"./chunk-H2JBVQRL.js";import"./chunk-DTICWRO3.js";import{a as oe}from"./chunk-U2DSLRRK.js";import{a as ae,b as le,c as re,d as se,e as ce,f as me}from"./chunk-2C4VCG6N.js";import{b as X,c as Z,f as $,i as ee,j as te,k as ne,n as ie}from"./chunk-NJ67TIRQ.js";import{a as Q}from"./chunk-IARL6YQG.js";import{Aa as C,Fa as d,Fb as G,Ga as t,Ha as n,Hb as U,Ia as k,Ib as q,Ma as _,N as j,Pa as h,Pb as J,Qa as s,U as c,V as m,Xa as i,Ya as f,Za as g,ab as E,bb as V,cb as N,d as T,eb as F,g as R,ia as r,ib as y,jb as P,kb as z,l as L,ra as v,u as D,ua as b,ub as B,va as W,vb as M,wb as H,xb as Y,y as w,ya as A}from"./chunk-I3ZBIMQN.js";function Se(l,p){if(l&1){let e=_();t(0,"input",8),N("ngModelChange",function(o){c(e);let u=s();return V(u.model.value,o)||(u.model.value=o),m(o)}),n()}if(l&2){let e=s();E("ngModel",e.model.value)}}function Oe(l,p){if(l&1){let e=_();t(0,"select",9),N("ngModelChange",function(o){c(e);let u=s();return V(u.model.value,o)||(u.model.value=o),m(o)}),t(1,"option",10),i(2,"Yes"),n(),t(3,"option",10),i(4,"No"),n()()}if(l&2){let e=s();E("ngModel",e.model.value),r(),d("ngValue",!0),r(2),d("ngValue",!1)}}var S=class l{_onconfirmed=new R;get onconfirmed(){return this._onconfirmed}messageCount=0;model={confirmed:!1,title:"",property:"",value:null,type:"text"};_confirmed=!1;constructor(){}ngOnInit(){}confirm(){this._confirmed=!0,this.model.confirmed=!0,this._onconfirmed.next(this.model)}ngOnDestroy(){this._confirmed||(this.model.confirmed=!1,this._onconfirmed.next(this.model))}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=b({type:l,selectors:[["app-channel-option-modal"]],standalone:!1,decls:13,vars:3,consts:[["mat-dialog-title","",1,"title"],[1,"content"],[1,"form-item"],["placeholder","Option Value","class","target-text","type","text",3,"ngModel","ngModelChange",4,"ngIf"],["class","jockey-select",3,"ngModel","ngModelChange",4,"ngIf"],[1,"buttons"],["mat-button","","mat-dialog-close","",1,"modal-btn","btn-blue",3,"click"],["mat-button","","mat-dialog-close","",1,"modal-btn","btn-grey"],["placeholder","Option Value","type","text",1,"target-text",3,"ngModelChange","ngModel"],[1,"jockey-select",3,"ngModelChange","ngModel"],[3,"ngValue"]],template:function(e,a){e&1&&(t(0,"h2",0),i(1,"Channel Option Change"),n(),t(2,"mat-dialog-content",1)(3,"div",2)(4,"label"),i(5),n(),C(6,Se,1,1,"input",3)(7,Oe,5,3,"select",4),n()(),t(8,"mat-dialog-actions",5)(9,"button",6),h("click",function(){return a.confirm()}),i(10,"Confirm"),n(),t(11,"button",7),i(12,"Cancel"),n()()),e&2&&(r(5),f(a.model.title),r(),d("ngIf",a.model.type=="text"),r(),d("ngIf",a.model.type=="checkbox"))},dependencies:[M,le,re,ce,se,te,ne,X,ee,Z,$],styles:[".title[_ngcontent-%COMP%]{color:#eee}.content[_ngcontent-%COMP%]{padding:0 25px 10px;display:block}.content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#d2d2d2;font-size:14px;line-height:30px}.content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:20px 0}.target-text[_ngcontent-%COMP%]{border:1px solid #555;background-color:#000;color:#eee;font-size:14px;font-weight:500;padding:8px;width:320px}.target-text[_ngcontent-%COMP%]:focus, .target-text[_ngcontent-%COMP%]:active{border-color:#048cca}.form-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;align-content:stretch;align-items:stretch;justify-content:stretch;justify-items:stretch;padding:8px 0}.form-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:1 1 auto;color:#bbb;font-size:13px;text-transform:uppercase;padding:4px 0;font-weight:500}.form-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1 1 auto;width:432px}.form-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1 1 auto;width:450px}"]})};function Ie(l,p){if(l&1){let e=_();t(0,"a",22),h("click",function(){c(e);let o=s(2);return m(o.viewInitialMessage())}),i(1,"View"),n()}}function De(l,p){if(l&1){let e=_();t(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"div",20),i(5,"Name"),n(),t(6,"div",21),i(7),t(8,"a",22),h("click",function(){c(e);let o=s();return m(o.remove())}),i(9,"Delete"),n()()(),t(10,"div",19)(11,"div",20),i(12,"Topic"),n(),t(13,"div",21),i(14),t(15,"a",22),h("click",function(){c(e);let o=s();return m(o.changeOption("Topic","topic",o.channel.topic))}),i(16,"Change"),n()()(),t(17,"div",19)(18,"div",20),i(19,"Status"),n(),t(20,"div",21),i(21),n()(),t(22,"div",19)(23,"div",20),i(24,"Initial Message"),n(),t(25,"div",21),i(26),C(27,Ie,2,0,"a",23),n()(),t(28,"div",19)(29,"div",20),i(30,"Client Limit"),n(),t(31,"div",21),i(32),y(33,"unlimited"),t(34,"a",22),h("click",function(){c(e);let o=s();return m(o.changeOption("Client Limit","clientLimit",o.channel.options.clientLimit))}),i(35,"Change"),n()()(),t(36,"div",19)(37,"div",20),i(38,"Message Size Limit"),n(),t(39,"div",21),i(40),y(41,"unlimited"),t(42,"a",22),h("click",function(){c(e);let o=s();return m(o.changeOption("Message Size Limit","messageSizeLimit",o.channel.options.messageSizeLimit))}),i(43,"Change"),n()()(),t(44,"div",19)(45,"div",20),i(46,"Auto Destroy"),n(),t(47,"div",21),i(48),t(49,"a",22),h("click",function(){c(e);let o=s();return m(o.changeOption("Auto Destroy","autoDestroy",o.channel.options.autoDestroy,"checkbox"))}),i(50,"Change"),n()()(),t(51,"div",19)(52,"div",20),i(53,"Auto Destroy Idle"),n(),t(54,"div",21),i(55),t(56,"a",22),h("click",function(){c(e);let o=s();return m(o.changeOption("Auto Destroy Idle","autoDestroyIdleSeconds",o.channel.options.autoDestroyIdleSeconds))}),i(57,"Change"),n()()()()()()}if(l&2){let e=s();r(7),g(" ",e.channel.name," "),r(7),g(" ",e.channel.topic," "),r(7),f(e.channel.status),r(5),g(" ",e.channel.hasInitialMessage?"":"None"," "),r(),d("ngIf",e.channel.hasInitialMessage),r(5),g(" ",P(33,9,e.channel.options.clientLimit)," "),r(8),g(" ",P(41,11,e.channel.options.messageSizeLimit)," "),r(8),g(" ",e.channel.options.autoDestroy?"Yes":"No"," "),r(7),g(" ",e.channel.options.autoDestroyIdleSeconds," Seconds ")}}function we(l,p){if(l&1&&(t(0,"div",26)(1,"div",27)(2,"span"),i(3),n()(),t(4,"div",27)(5,"span"),i(6),n()(),t(7,"div",28)(8,"a",29),i(9),n()(),t(10,"div",30)(11,"span"),i(12),y(13,"date"),n()()()),l&2){let e=p.$implicit;r(3),f(e.type),r(3),f(e.name),r(2),d("routerLink",F("/client/",e.id)),r(),f(e.id),r(3),f(z(13,6,e.subscriptionDate*1e3,"yyyy-MM-dd HH:mm:ss"))}}function ke(l,p){if(l&1&&(t(0,"div",24),C(1,we,14,9,"div",25),n()),l&2){let e=s();r(),d("ngForOf",e.channel.subscribers)}}var O=class l extends Q{constructor(e,a,o,u,_e,x){super();this.activatedRoute=e;this.service=a;this.socket=o;this.dialog=u;this.router=_e;this.chartService=x}channelName="";channel=null;channelChart;ngOnInit(){return T(this,null,function*(){this.channelName=this.activatedRoute.snapshot.params.name,yield this.load(),this.subscribeWebsockets(),this.subscribeToListRefresh().subscribe(()=>this.service.get(this.channelName).subscribe(e=>this.channel=e.body))})}ngOnDestroy(){super.ngOnDestroy(),this.socket.unsubscribe("channel:"+this.channelName)}load(){this.service.get(this.channelName).subscribe(e=>{this.channel=e.body,this.service.getGraph(this.channelName).subscribe(a=>{this.channelChart&&this.channelChart.destroy(),this.channelChart=new de(document.getElementById("messages-chart"),{type:"line",data:{labels:a.labels,datasets:[{label:"Published",borderColor:"#2070e0",data:a.d.map(o=>o.s),fill:!1,pointRadius:1,pointHitRadius:8,tension:.2,borderWidth:2},{label:"Received",borderColor:"#10c070",data:a.d.map(o=>o.r),fill:!1,pointRadius:1,pointHitRadius:8,tension:.2,borderWidth:2}]},options:{animation:{duration:0},hover:{mode:"nearest",intersect:!0},responsive:!0,scales:{x:{display:!1},y:{display:!0,ticks:{precision:0}}}}})})})}subscribeWebsockets(){this.on(this.socket.onmessage).pipe(D(e=>e.type==he.ChannelGraph&&e.payload.n==this.channelName),D(()=>this.channelChart!=null),L(e=>e.payload)).subscribe(e=>this.chartService.updateChart(this.channelChart,e)),this.socket.subscribe("channel:"+this.channelName)}changeOption(e,a,o,u="text"){let x=this.dialog.open(S,{width:"500px"}).componentInstance;x.model.title=e,x.model.property=a,x.model.value=o,x.model.type=u,x.onconfirmed.pipe(w(1)).subscribe(I=>{I.confirmed&&this.service.setOption(this.channelName,I.property,I.value).subscribe(()=>this.load())})}remove(){let a=this.dialog.open(pe).componentInstance;a.message='You are about to delete <b class="imp">'+this.channelName+"</b> Channel. Are you sure?",a.onclosed.pipe(w(1)).subscribe(o=>{o&&this.service.remove(this.channelName).subscribe(u=>{this.router.navigateByUrl("/channels")})})}viewInitialMessage(){this.dialog.open(ve,{panelClass:"wide-modal"}).componentInstance.load(this.channelName)}static \u0275fac=function(a){return new(a||l)(v(G),v(ge),v(K),v(ae),v(U),v(ue))};static \u0275cmp=b({type:l,selectors:[["app-channel-detail"]],standalone:!1,features:[A],decls:30,vars:2,consts:[[1,"centered-body"],[1,"vertical-content"],[1,"dashboard-portlet"],[1,"portlet"],[1,"portlet-title"],[1,"portlet-canvas"],["id","messages-chart"],["class","portlet-body",4,"ngIf"],[1,"portlet","full"],[1,"portlet-body","table","table-small","nowrap"],[1,"thead"],[1,"th","fx24"],[1,"th","fx30"],[1,"th","fx22"],["class","tbody",4,"ngIf"],[2,"height","80px"],[1,"portlet-body"],[1,"portlet-table","grow","canvas-info"],[1,"key-value-table"],[1,"kvt-row"],[1,"kvt-key"],[1,"kvt-value"],[1,"change-option",3,"click"],["class","change-option",3,"click",4,"ngIf"],[1,"tbody"],["class","trow",4,"ngFor","ngForOf"],[1,"trow"],[1,"td","fx24"],[1,"td","fx30"],[3,"routerLink"],[1,"td","fx22"]],template:function(a,o){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Channel Messages"),n(),t(6,"div",5),k(7,"canvas",6),n()()(),t(8,"div",2)(9,"div",3)(10,"h3",4),i(11,"Options & Actions"),n(),C(12,De,58,13,"div",7),n()()()(),t(13,"div",0)(14,"div",1)(15,"div",8)(16,"h3",4),i(17,"Channel Subscribers"),n(),t(18,"div",9)(19,"div",10)(20,"div",11),i(21,"Type"),n(),t(22,"div",11),i(23,"Name"),n(),t(24,"div",12),i(25,"Id"),n(),t(26,"div",13),i(27,"Subscribed Date"),n()(),C(28,ke,2,1,"div",14),n()()()(),k(29,"div",15)),a&2&&(r(12),d("ngIf",o.channel),r(16),d("ngIf",o.channel))},dependencies:[B,M,q,H,fe],encapsulation:2})};var xe=class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=W({type:l});static \u0275inj=j({imports:[Y,oe,me,ie,J.forChild([{path:":name",component:O}])]})};export{xe as ChannelDetailModule};
